---
title: Shader入门
date: 2021-12-05 22:46:00
updated: 2021-12-05 22:46:00
id: ml-20211205-224600-g174
categories:
	- Unity
	- TA
tags: 
	- Unity
	- TA
	- Shader
---



<!--more-->

# 渲染流水线

渲染流水线的最终目的在于生成(渲染)一张二维纹理, 即我们在电脑屏幕上看到的所有效果, 他的输入是一个虚拟摄像机, 一些光源, 一些Shader以及纹理等.

## 什么是流水线

![2_1-真实生活中的流水线][2_1-真实生活中的流水线]

当一个产品需要四个步骤,每个步骤需要一小时, 并不是说生产一个产品就需要四小时, 通过**流水线**每个步骤同时进行,就可以一小时产生一个产品.  
可用发现,流水线系统的运行效率取决于其中最慢的工序.  
理想情况下,将一个非流水线系统分为n个流水线阶段, 且每个阶段耗时相同, 则整个系统会获得n倍的效率提升.

## 什么是渲染流水线

将上述流水线的概念普及到计算机的图形渲染种  
渲染流水线的工作任务在于,由一个三维场景出发, 生成一张二维图像, 计算机需要从一系列参数(顶点,纹理,等)信息出发, 把这些信息转换为人眼可以看到的图像, 这些工作由CPU和GPU共同完成

![流水线中的三个概念阶段][流水线中的三个概念阶段]

`<Render-Time Rendering, Third Edition>`书种将渲染分为3个阶段
* 应用阶段(Application Stage)
* 几何阶段(Geometry Stage)
* 光栅化阶段(Resterizer Stage)

> 注意,这仅仅是概念性的阶段,每个阶段通常也是一个流水线系统

### 应用阶段

由应用主导,通常由CPU负责实现, 开发者拥有这个阶段的控制权

开发者有三个任务

1. 主备好场景数据,如`摄像机位置`,`视锥体`,`场景中的模型`,`光源`等.
2. 为提高渲染效率,需要进行一些粗粒度剔除工作, 把那些不可见的物体剔除出去,不需要将他们提交给几何阶段
3. 设置每个模型的渲染状态, 这些渲染状态包括但不限于`材质(漫反射,高光反射)`,`纹理`,`使用的Shader`等.

这一阶段最重要的是要输出渲染所需的几何信息,即**渲染图元(rendering primitives)**  
通俗来讲,渲染图元可以是点,线,三角面等, 这些渲染图元会被传递给下个阶段---`几何阶段`

> 剔除一般含有`遮挡剔除`,`层级剔除`,`视锥体剔除`等, 这取决于开发者.  

> 粗粒度剔除, 这是为了区分`裁剪(clipping)`与`剔除(culling)`的区别,  
> 粒度不同是指,*剔除是在object层面的*，对object的各项属性做处理,并决定是否部将其传入几何阶段, *裁剪是在图元（三角形）层面的*,对构成object mesh的三角形再做裁剪

### 几何阶段

处理所有和我们要绘制的几何相关的事情, 例如,决定需要绘制的图元是什么,怎样绘制他们,在哪里绘制他们.这一阶段通常在GPU上进行.

几何阶段负责和每个渲染图元打交道, 进行逐顶点,逐多边形的操作.  
这一阶段还可以细分为更小的流水线阶段,后面会提到.  

这一阶段最重要的是吧**顶点坐标变换到屏幕空间**中, 再交给*光栅器*进行处理.  
通过对输入的渲染图元进行多部处理后, 这一阶段将会输出屏幕空间的二维顶点坐标, 每个顶点对应的深度值,着色等相关信息, 并传递给下个阶段.

### 光栅化阶段

接受上个阶段传递的数据来生成屏幕上的像素, 并渲染出最终的图像, 这一阶段也是在GPU上进行的.

光栅化的任务主要是决定每个渲染图元中的那些像素应该被绘制在屏幕上  
这需要对上个阶段得到的*逐顶点数据(纹理坐标,顶点颜色等)*进行插值, 然后进行逐像素处理.

光栅化也可以分成更小的流水线

> 上述所有流水线均为概念流水线, 是依据渲染流程进行基本功能划分而提出的, 下面介绍GPU的流水线, 则是硬件真正用于实现上述概念的实际流水线.

## CPU和GPU之间的通信

渲染流水线起始于CPU,也就是应用阶段, 大致分为下面3个阶段.
1. 吧数据加载到显存中
2. 设置渲染状态
3. 调用`Draw Call`(后续讨论Draw Call是什么)

### 吧数据加载到显存中

### 设置渲染状态

### 调用Draw Call

# 完毕

**感谢您的观看!**  
本文来自 [ML-Blog][ML-Blog_Link]

<!-- 图片 -->

<!-- 链接 -->

<!-- 水印 -->
[ML-Blog_Link]:https://userminghaoli.github.io/ "我的博客"
