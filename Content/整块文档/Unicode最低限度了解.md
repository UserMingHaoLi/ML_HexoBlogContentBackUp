---
title: Unicode最低限度了解
date: 2024-06-24 20:07:00
updated: 2024-06-24 20:07:00
id: ml-20240624-200700-g201
categories:
	- Unicode
tags: 
	- Unicode
---


**没有`纯文本`这样的东西。**


<!--more-->

在不知道字符串使用什么编码的情况下拥有字符串是没有意义的。比如假装`ASCII`是**纯**文本 

# 什么是Unicode

Unicode 是一种标准，旨在统一过去和现在的所有人类语言，并使它们与计算机一起使用

在实践中，Unicode 是一个为不同字符分配唯一编号的表

例如：

拉丁字母被分配了数字 。A65

Unicode 将这些数字称为码位

由于世界上每个人都同意哪些数字对应哪些字符，并且我们都同意使用Unicode，因此我们可以阅读彼此的文本  
> 这些`同意`实际是内置在各种基础建设中了


`Unicode == 字符 ⟷ 码位`



# Unicode有多大？

目前，最大定义的码位为 0x10FFFF。这为我们提供了大约 110 万个码位的空间。

目前定义了大约 170,000 个，即 15%。另外11%保留给私人使用。其余的大约800,000个码位，目前没有分配。他们可能会成为未来的角色。


# 什么是私人用途？


这些是为应用开发人员保留的码位，永远不会由 Unicode 本身定义


例如，Unicode 中没有 Apple标志 的位置，因此 Apple 将其放在“私人使用”块中的位置。在任何其他字体中，它都会呈现为缺少字形，但在 macOS 附带的字体中，您会看到他 即`U+F8FF`(被咬了一口的黑色苹果图标)


# 什么是UTF-8呢


UTF-8 是一种编码。编码是我们在内存中存储码位的方式。

Unicode 最简单的编码是 UTF-32。它只是将码位存储为 32 位整数,占用四个字节。所以UTF-32 中的任何其他码位也将占用 4 个字节。

UTF-16 和 UTF-8 不那么简单，但最终目标是相同的：获取一个码位并将其编码为字节

UTF-8 是一种可变长度编码。编码为一到四个字节的序列

如下  

```
U+..0000007F	0xxxxxxx  
U+..008007FF	110xxxxx	10xxxxxx  
U+..0800FFFF	1110xxxx	10xxxxxx	10xxxxxx  
U+..1000010FFFF	11110xxx	10xxxxxx	10xxxxxx	10xxxxxx  
```

如果将其与 Unicode 表结合使用，您会看到英语编码为 1 字节，西里尔语、拉丁欧洲语言、希伯来语和阿拉伯语需要 2 字节，中文、日语、韩语、其他亚洲语言和表情符号需要 3 或 4 个字节


这里有几个要点:
* UTF-8 与 ASCII 字节兼容(U+..00000127)以前的字符能完全匹配
* UTF-8 内置了错误检测和恢复功能。第一个字节的前缀看起来总是与字节 2-4 不同。这样一来，你总是可以判断你是否在查看一个完整且有效的 UTF-8 字节序列

还有几个重要的后果：

* 无法通过计算字节数来确定字符串的长度。
* 无法通过以任意字节偏移量进行剪切来获取子字符串。当心切断部分字符。


# 扩展字符

一个码位并不总是一个字符

在Unicode中，一些字素簇是用多个码位编码的
> 据我所知，没有最大数量限制

我们可以把Unicode本身（没有任何编码）看作是可变长度的

> 扩展字形簇是一个或多个 Unicode 码位的序列，必须将其视为单个牢不可破的字符

不尊重字形簇会导致删除某个emoji的一半, 然后变成另一个emoji
> 由多个码位编码的unicode字素簇 大部分是emoji  
> 但是很多语言中的文字也会使用超过2个码位


# 对于编码的影响

`{string}.length`是我们常用的方法, 他对于一个Unicode字素簇可能不是很友好 
> 在你的编码语言中试试任何emoji的length


不同的语言使用不同的内部字符串表示形式（UTF-32、UTF-16、UTF-8），并以存储字符的任何单位（整数、短行列、字节）报告长度

## 那么如何检测扩展的字素簇呢

使用正确的Unicode库！

* C/C++/Java：使用 `ICU`。它是Unicode本身的一个库，它编码了有关文本分割的所有规则。
* C#：使用`TextElementEnumerator`据我所知，它与Unicode保持同步。
* 对于其他语言，可能都有一些类似的库。
* 自己写。Unicode发布规则表，上面的所有库都基于它们。
但无论你选择什么，都要确保它使用足够新的Unicode版本，因为字素簇的定义因版本而异

> 注意你使用的库中Unicode的版本


# 规则正在改变

大约从 2014 年开始，Unicode 每年都会发布其标准的重大修订版。
每年的 Android 和 iOS 更新通常包括最新的 Unicode 标准

定义字素簇的规则每年也在变化。今天被认为是两个或三个独立码位的序列，明天可能会变成一个字素簇！没有办法知道！或者提前准备

更糟糕的是, 你自己的应用可能在不同版本的 Unicode 标准上运行，并报告不同的字符串长度, 或其他字符串数据

**你在这里真的别无选择。如果您想保持相关性并提供体面的用户体验，则不能忽略 Unicode  更新**
> 每年更新

# 相等性比较

将以下任一内容复制到 JavaScript 控制台 

> 在游览器中按下F12就可以打开

```JavaScript
"Å" === "Å"
"Å" === "Å"
"Å" === "Å"
```

你应该得到`false`

因为他们的码位以及组合方式不一样(你可以尝试输出其Unicode字符)

这就是为什么我们需要规范化

> 在比较字符串或搜索子字符串之前，请进行规范化

# Unicode 取决于语言环境

即使是完全相同的Unicode字符, 在不同的展示环节仍然会显示不同的字符

Unicode并不是一个完美的系统，它有很多缺点。其中包括将相同的码位分配给应该看起来不同的字形，例如西里尔语小写 K 和保加利亚语小写 K（两者都是 ）。U+043A

> 亚洲文字的情况要糟糕得多：许多写法截然不同的中文、日文和韩文的被分配了相同的码位

不幸的是，这使得Unicode未能实现最初目标：

> 即:无需转义序列或控制代码即可指定任何语言中的任何字符


在实践中，对语言环境的依赖会带来很多问题：

* 作为元数据，区域设置经常丢失。
* 人们并不局限于一个区域设置。例如，我可以读写英语（美国）、英语（英国）、德语和俄语。我应该将计算机设置为哪个区域设置？
* 很难混搭。就像保加利亚语文本中的俄语名称一样，反之亦然。这是互联网，来自各种文化背景的人们在这里闲逛. 里面到处都是国际文字的混搭情况。
* 没有地方可以指定区域设置，因为在大多数软件中，没有下拉列表或文本输入来更改区域设置。
* 需要时，必须猜测。例如，Twitter(X) 试图从推文本身的文本中猜测语言环境（它还能从哪里得到？），有时会弄错
* 你不能在不知道字符串是用什么语言写入的情况下将字符串转换为小写的(比如字母i分为有点的和无点的)

# 还有其他要关心的吗

* 引号 `“` `”` `‘` `’`
* 省略符号`’`
* 破折号`–` `—`
* 货币符号`$` `€` `¢` `£`
* 数学符号  加号和等号是 ASCII 的一部分，但减号和乘号不是, 其他高级一点的数学符号更是重灾区

> 更多学习: 什么是代理对?


# 结论

总结一下：

* Unicode赢了。
* UTF-8 是传输中和静态数据最流行的编码。
* UTF-16 有时仍用作内存中的表示形式(涵盖所有人类语言的固定宽度编码的承诺是如此引人注目，以至于许多系统都渴望采用它)。
* 字符串的两个最重要的视图是字节（分配内存/复制/编码/解码）和扩展字素簇（所有语义操作）。
* 一个字素簇可以由多个码位组成(写代码时小心了)。
* 对所有 Unicode 都使用 Unicode 库
* Unicode 每年都会更新，规则有时会更改。
* Unicode 字符串需要先规范化，然后才能进行比较。
* Unicode 依赖于某些操作和呈现的区域设置。


总的来说，是的，Unicode并不完美，但事实是

存在一种同时涵盖所有可能语言的编码，  
全世界都同意使用它，  
我们可以完全忘记编码和转换以及所有这些东西  
这是一个奇迹。

**有一种东西是`纯文本`，它是用 UTF-8 编码的。**

# 完毕

**感谢您的观看!**  
本文来自 [ML-Blog][ML-Blog_Link]

<!-- 图片 -->
[UMLClassMode]:https://github.com/UserMingHaoLi/ML_HexoBlogContentImages/blob/main/Content/%E6%A8%A1%E6%9D%BF/UML%E7%B1%BB%E5%9B%BE%E6%A8%A1%E6%9D%BF.png "UML类图模板"
<!-- 链接 -->

<!-- 水印 -->
[ML-Blog_Link]:https://userminghaoli.github.io/ "我的博客"
